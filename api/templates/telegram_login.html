{% extends "base.html" %}

{% block title %}Telegram Login{% endblock %}

{% block content %}
<h1>ğŸ“± Telegram Account Login</h1>

{% if session_data %}
<!-- Already logged in -->
<div class="card">
    <h2>âœ… Active Session</h2>
    <table>
        <thead>
            <tr>
                <th>Property</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Phone</strong></td>
                <td><code>{{ session_data.phone }}</code></td>
            </tr>
            <tr>
                <td><strong>User ID</strong></td>
                <td><code>{{ session_data.user_id }}</code></td>
            </tr>
            <tr>
                <td><strong>Name</strong></td>
                <td>{{ session_data.first_name }} {{ session_data.last_name or '' }}</td>
            </tr>
            {% if session_data.username %}
            <tr>
                <td><strong>Username</strong></td>
                <td>@{{ session_data.username }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <div style="margin-top: 1.5rem;">
        <form method="POST" style="display:inline;">
            <input type="hidden" name="action" value="logout">
            <button type="submit" class="btn-danger" onclick="return confirm('Logout from Telegram?');">
                ğŸšª Logout
            </button>
        </form>
    </div>
</div>

<div class="alert alert-success">
    âœ… <strong>Ready to Create Groups!</strong><br>
    Your session is saved. You can now create escrow groups with this account!
</div>

{% else %}
<!-- Login Form -->
<div class="card">
    <h2>Login to Telegram</h2>

    {% if login_step == 'phone' %}
    <!-- Step 1: Phone Number -->
    <p style="color: #64748b; margin-bottom: 1.5rem;">Enter your phone number with country code.</p>
    <form method="POST">
        <input type="hidden" name="action" value="send_code">
        <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" placeholder="+1234567890" required autofocus>
            <small style="color: #64748b;">Include country code (e.g., +1, +91, +44)</small>
        </div>
        <button type="submit" class="btn-success">ğŸ“± Send Code</button>
    </form>

    {% elif login_step == 'code' %}
    <!-- Step 2: Verification Code -->
    <p style="color: #64748b; margin-bottom: 0.5rem;">Code sent to: <strong>{{ phone }}</strong></p>
    <form method="POST">
        <input type="hidden" name="action" value="verify_code">
        <div class="form-group">
            <label for="code">Verification Code</label>
            <input type="text" id="code" name="code" placeholder="12345" required autofocus>
            <small style="color: #64748b;">Check Telegram app or SMS</small>
        </div>
        <button type="submit" class="btn-success">âœ… Verify</button>
    </form>
    <form method="POST" style="margin-top: 1rem;">
        <input type="hidden" name="action" value="start_over">
        <button type="submit" class="btn-secondary">ğŸ”™ Start Over</button>
    </form>

    {% elif login_step == 'password' %}
    <!-- Step 3: 2FA Password -->
    <p style="color: #64748b; margin-bottom: 1.5rem;">2FA enabled. Enter your password.</p>
    <form method="POST">
        <input type="hidden" name="action" value="verify_password">
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required autofocus>
        </div>
        <button type="submit" class="btn-success">ğŸ” Verify</button>
    </form>
    <form method="POST" style="margin-top: 1rem;">
        <input type="hidden" name="action" value="start_over">
        <button type="submit" class="btn-secondary">ğŸ”™ Start Over</button>
    </form>
    {% endif %}
</div>
{% endif %}
{% endblock %}